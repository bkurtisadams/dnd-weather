{{!-- Weather dialog template --}}
<form class="dnd-weather-dialog">
  <div class="dialog-content">
    <div class="weather-controls">
        <div class="form-group">
            <label>Month:</label>
            <select name="month" {{#if loading}}disabled{{/if}}>
                {{#each months}}
                    <option value="{{this}}" {{#if (eq ../selectedMonth this)}}selected{{/if}}>{{this}}</option>
                {{/each}}
            </select>
        </div>

        <div class="form-group">
            <label>Day:</label>
            <input type="number" name="day" value="{{selectedDay}}" min="1" max="28" {{#if loading}}disabled{{/if}}>
        </div>

        <div class="form-group">
            <label>Latitude:</label>
            <input type="number" name="latitude" value="{{latitude}}" min="0" max="90" {{#if loading}}disabled{{/if}}>
        </div>

        <div class="form-group">
            <label>Terrain:</label>
            <select name="terrain" {{#if loading}}disabled{{/if}}>
                {{#each terrainTypes}}
                    <option value="{{this}}" {{#if (eq this ../terrain)}}selected{{/if}}>{{this}}</option>
                {{/each}}
            </select>
        </div>

        <div class="form-group">
            <label>Elevation (ft):</label>
            <input type="number" name="elevation" value="{{elevation}}" min="0" step="100" {{#if loading}}disabled{{/if}}>
        </div>
    </div>

    {{!-- Sky Conditions Section --}}
    <div class="flexcol">
        <h3 class="weather-header">Sky Conditions</h3>
        <div class="weather-value">
            {{weather.conditions}}
            <i class="fas 
                {{~#if (eq weather.conditions 'Clear')}} fa-sun{{/if}}
                {{~#if (eq weather.conditions 'Partly Cloudy')}} fa-cloud-sun{{/if}}
                {{~#if (eq weather.conditions 'Cloudy')}} fa-cloud{{/if~}}
            "></i>
        </div>
    </div>

    {{!-- Weather Display Section --}}
    <div class="weather-current {{#if loading}}loading{{/if}}">
      {{!-- Temperature Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-thermometer-half"></i>
        </div>
        <div class="weather-data">
          <h3>Temperature</h3>
          <p class="temperature">{{weather.temperature}}°F</p>
          {{#if weather.windChill}}
            <p class="wind-chill">
              Feels like {{weather.windChill}}°F
            </p>
          {{/if}}
        </div>
      </div>

      {{!-- Wind Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-wind"></i>
        </div>
        <div class="weather-data">
          <h3>Wind Conditions</h3>
          <p>{{weather.wind}} mph from the {{weather.windDirection}}</p>
        </div>
      </div>

      {{!-- Precipitation Section --}}
      <div class="weather-row">
          <div class="weather-icon">
              <i class="fas fa-cloud-rain"></i>
          </div>
          <div class="weather-data">
              <h3>Precipitation</h3>
              {{#if (eq weather.precipitation.type 'none')}}
                  <p>None</p>
              {{else}}
                  <div class="precip-details">
                      <h4>{{weather.precipitation.type}}</h4>
                      
                      <div class="precip-grid">
                          {{#if weather.precipitation.amount}}
                              <div class="detail-item">
                                  <span class="label">Amount:</span>
                                  <span class="value">{{weather.precipitation.amount}}</span>
                              </div>
                          {{/if}}
                          
                          {{#if weather.precipitation.duration}}
                              <div class="detail-item">
                                  <span class="label">Duration:</span>
                                  <span class="value">{{weather.precipitation.duration}}</span>
                              </div>
                          {{/if}}
                      </div>

                      <div class="effects-section">
                          <h4>Effects</h4>
                          
                          {{!-- Movement Effects --}}
                          <div class="effect-group">
                              <span class="effect-label">Movement:</span>
                              {{#if (isObject weather.precipitation.movement)}}
                                  <ul>
                                      {{#if weather.precipitation.movement.foot}}
                                          <li>On foot: {{weather.precipitation.movement.foot}}</li>
                                      {{/if}}
                                      {{#if weather.precipitation.movement.horse}}
                                          <li>Mounted: {{weather.precipitation.movement.horse}}</li>
                                      {{/if}}
                                      {{#if weather.precipitation.movement.cart}}
                                          <li>Carts/Wagons: {{weather.precipitation.movement.cart}}</li>
                                      {{/if}}
                                  </ul>
                              {{else}}
                                  <span>{{weather.precipitation.movement}}</span>
                              {{/if}}
                          </div>

                          {{!-- Vision Effects --}}
                          <div class="effect-group">
                              <span class="effect-label">Visibility:</span>
                              <span>{{weather.precipitation.vision}}</span>
                          </div>

                          {{#if weather.precipitation.infraUltra}}
                              <div class="effect-group">
                                  <span class="effect-label">Infra/Ultra Vision:</span>
                                  <span>{{weather.precipitation.infraUltra}}</span>
                              </div>
                          {{/if}}

                          {{#if weather.precipitation.tracking}}
                              <div class="effect-group">
                                  <span class="effect-label">Tracking:</span>
                                  <span>{{weather.precipitation.tracking}}</span>
                              </div>
                          {{/if}}

                          {{#if weather.precipitation.chanceLost}}
                              <div class="effect-group">
                                  <span class="effect-label">Chance of Getting Lost:</span>
                                  <span>{{weather.precipitation.chanceLost}}</span>
                              </div>
                          {{/if}}

                          {{#if weather.precipitation.windSpeed}}
                              <div class="effect-group">
                                  <span class="effect-label">Wind Speed:</span>
                                  <span>{{weather.precipitation.windSpeed}}</span>
                              </div>
                          {{/if}}
                          {{#if weather.precipitation.rainbowChance}}
                              <div class="effect-group">
                                  <span class="effect-label">Rainbow Chance:</span>
                                  <span>{{weather.precipitation.rainbowChance}}%</span>
                              </div>
                          {{/if}}
                      </div>

                      {{#if weather.precipitation.notes}}
                          <div class="precip-notes">
                              <h4>Notes</h4>
                              <p>{{weather.precipitation.notes}}</p>
                          </div>
                      {{/if}}
                  </div>
              {{/if}}
          </div>
      </div>

      {{!-- Special Weather Section --}}
      <div class="weather-section">
          <h3 class="weather-header">Effects</h3>
          
          {{#if effects.special.length}}
          <div class="weather-value">
              <label>Special Effects:</label>
              {{#each effects.special}}
                  <div>{{this}}</div>
              {{/each}}
          </div>
          {{/if}}

          {{#if weather.precipitation.continues}}
          <div class="weather-value">
              <label>Continuing Weather:</label>
              <div>Precipitation continues for {{weather.precipitation.duration}} hours</div>
          </div>
          {{/if}}
      </div>

      {{!-- Moon Phase Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-moon"></i>
        </div>
        <div class="weather-data">
          <h3>Moon Phases</h3>
          <div class="moon-details">
            <div class="moon-row">
              <span class="moon-label">Luna:</span>
              <div class="moon-info">
                {{#if weather.moonPhase.luna}}
                  <svg class="moon-icon" viewBox="0 0 100 100" width="24" height="24">
                    {{#if (eq weather.moonPhase.luna "New")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                    {{else if (eq weather.moonPhase.luna "1/4")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,1 50,98 A48,48 0 0,0 50,2" fill="white"/>
                    {{else if (eq weather.moonPhase.luna "Full")}}
                      <circle cx="50" cy="50" r="48" fill="white" stroke="gray"/>
                    {{else if (eq weather.moonPhase.luna "3/4")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,0 50,98 A48,48 0 0,1 50,2" fill="white"/>
                    {{else if (eq weather.moonPhase.luna "Waxing Crescent")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,1 50,98 A24,48 0 0,0 50,2" fill="white"/>
                    {{else if (eq weather.moonPhase.luna "Waxing Gibbous")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,1 50,98 A72,48 0 0,0 50,2" fill="white"/>
                    {{else if (eq weather.moonPhase.luna "Waning Gibbous")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,0 50,98 A72,48 0 0,1 50,2" fill="white"/>
                    {{else if (eq weather.moonPhase.luna "Waning Crescent")}}
                      <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                      <path d="M50,2 A48,48 0 0,0 50,98 A24,48 0 0,1 50,2" fill="white"/>
                    {{/if}}
                  </svg>
                {{/if}}
                <span>{{weather.moonPhase.luna}}</span>
              </div>
            </div>
            <div class="moon-row">
              <span class="moon-label">Celene:</span>
              <div class="moon-info">
                {{#if weather.moonPhase.celene}}
                    <svg class="moon-icon" viewBox="0 0 100 100" width="24" height="24">
                        {{#if (eq weather.moonPhase.celene "New")}}
                            <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                        {{else if (eq weather.moonPhase.celene "1/4")}}
                            <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                            <path d="M50,2 A48,48 0 0,1 50,98 A48,48 0 0,0 50,2" fill="white"/>
                        {{else if (eq weather.moonPhase.celene "Full")}}
                            <circle cx="50" cy="50" r="48" fill="white" stroke="gray"/>
                        {{else if (eq weather.moonPhase.celene "3/4")}}
                            <circle cx="50" cy="50" r="48" fill="black" stroke="gray"/>
                            <path d="M50,2 A48,48 0 0,0 50,98 A48,48 0 0,1 50,2" fill="white"/>
                        {{else}}
                            <circle cx="50" cy="50" r="48" fill="gray" stroke="darkgray"/>
                        {{/if}}
                    </svg>
                {{/if}}
                <span>{{weather.moonPhase.celene}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {{!-- Sunrise/Sunset Section --}}
    <div class="weather-row">
      <div class="weather-icon">
        <i class="fas fa-sun"></i>
      </div>
      <div class="weather-data">
        <h3>Daylight</h3>
        <div class="daylight-details">
          <div class="daylight-row">
            <span class="daylight-label">Sunrise:</span>
            <span>{{weather.daylight.sunrise}}</span>
          </div>
          <div class="daylight-row">
            <span class="daylight-label">Sunset:</span>
            <span>{{weather.daylight.sunset}}</span>
          </div>
        </div>
      </div>
    </div>
    
    {{!-- Weather Controls --}}
    <div class="dialog-buttons">
        <button type="button" class="generate-weather" {{#if loading}}disabled{{/if}}>
            Generate New Weather
        </button>
        
        {{#if isGM}}
        <button type="button" class="update-weather" {{#if loading}}disabled{{/if}}>
            Update Weather
        </button>
        <button type="button" class="settings" {{#if loading}}disabled{{/if}}>
            Settings
        </button>
        {{/if}}

        <button type="button" class="refresh-weather" {{#if loading}}disabled{{/if}}>
            Refresh
        </button>
    </div>

    {{!-- Debug info section --}}
    {{#if error}}
    <div class="error-message" style="color: red; margin-top: 10px;">
        Error: {{error}}
    </div>
    {{/if}}

    {{#if debugMode}}
    <div class="debug-info" style="margin-top: 10px; font-size: 0.8em; color: #666;">
        Available Months: {{#each months}}{{this}}, {{/each}}<br>
        Selected Month: {{selectedMonth}}<br>
        Latitude: {{latitude}}<br>
        Terrain: {{terrain}}<br>
        Elevation: {{elevation}}
    </div>
    {{/if}}
  </div>
</form>