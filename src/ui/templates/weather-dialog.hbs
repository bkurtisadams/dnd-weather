{{!-- Weather dialog template --}} 
<form class="dnd-weather-dialog">
  <div class="dialog-content">
    {{#if loading}}
      <div class="weather-loading">
        <i class="fas fa-spinner fa-spin"></i> Loading...
      </div>
    {{/if}}

    {{#if error}}
      <div class="weather-error">
        <i class="fas fa-exclamation-circle"></i>
        <span>{{error}}</span>
      </div>
    {{/if}}

    {{!-- Add before the weather display section, around line 12 --}}
    <div class="weather-controls mb-2">
        <div class="form-group">
          <label>Month:
              <select name="month" {{#if loading}}disabled{{/if}}>
                  {{#each months}}
                      <option value="{{this}}" {{#if (eq ../selectedMonth this)}}selected{{/if}}>
                          {{this}}
                      </option>
                  {{/each}}
              </select>
          </label>
      </div>
        
        <div class="form-group">
            <label>Latitude:
                <input type="number" name="latitude" value="{{latitude}}" min="0" max="90" {{#if loading}}disabled{{/if}}>
            </label>
        </div>
        
        <div class="form-group">
            <label>Terrain:
                <select name="terrain" {{#if loading}}disabled{{/if}}>
                    {{#each terrainTypes}}
                        <option value="{{this}}" {{#if (eq this ../terrain)}}selected{{/if}}>{{this}}</option>
                    {{/each}}
                </select>
            </label>
        </div>
        
        <div class="form-group">
            <label>Elevation (ft):
                <input type="number" name="elevation" value="{{elevation}}" min="0" step="100" {{#if loading}}disabled{{/if}}>
            </label>
        </div>
    </div>

    <div class="weather-current {{#if loading}}loading{{/if}}">
      {{!-- Temperature Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-thermometer-half"></i>
        </div>
        <div class="weather-data">
          <h3>Temperature</h3>
          <p class="temperature">{{weather.temperature}}°F</p>
          {{#if weather.windChill}}
            <p class="wind-chill">
              Feels like {{weather.windChill}}°F
            </p>
          {{/if}}
        </div>
      </div>

      {{!-- Wind Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-wind"></i>
        </div>
        <div class="weather-data">
          <h3>Wind Conditions</h3>
          <p>{{weather.wind}} mph from the {{weather.windDirection}}</p>
        </div>
      </div>

      {{!-- Precipitation Section --}}
      {{!-- Replace the precipitation section (around line 40) --}}
      <div class="weather-row">
          <div class="weather-icon">
              <i class="fas fa-cloud-rain"></i>
          </div>
          <div class="weather-data">
              <h3>Precipitation</h3>
              {{#if (eq weather.precipitation.type 'none')}}
                  <p>None</p>
              {{else}}
                  <p class="precip-type">Type: {{weather.precipitation.type}}</p>
                  
                  {{#if weather.precipitation.amount}}
                      <p class="precip-amount">Amount: {{weather.precipitation.amount}}</p>
                  {{/if}}
                  
                  {{#if weather.precipitation.duration}}
                      <p class="precip-duration">Duration: {{weather.precipitation.duration}}</p>
                  {{/if}}
                  
                  {{#if weather.precipitation.movement}}
                      <div class="precip-movement">
                          <p>Movement Effects:</p>
                          {{#if (isObject weather.precipitation.movement)}}
                              <ul>
                                  {{#if weather.precipitation.movement.foot}}
                                      <li>On foot: {{weather.precipitation.movement.foot}}</li>
                                  {{/if}}
                                  {{#if weather.precipitation.movement.horse}}
                                      <li>Mounted: {{weather.precipitation.movement.horse}}</li>
                                  {{/if}}
                                  {{#if weather.precipitation.movement.cart}}
                                      <li>Carts/Wagons: {{weather.precipitation.movement.cart}}</li>
                                  {{/if}}
                              </ul>
                          {{else}}
                              <p>{{weather.precipitation.movement}}</p>
                          {{/if}}
                      </div>
                  {{/if}}
                  
                  {{#if weather.precipitation.vision}}
                      <div class="precip-vision">
                          <p>Visibility: {{weather.precipitation.vision}}</p>
                      </div>
                  {{/if}}
                  
                  {{#if weather.precipitation.notes}}
                      <div class="precip-notes">
                          <p class="notes-header">Notes:</p>
                          <p>{{weather.precipitation.notes}}</p>
                      </div>
                  {{/if}}
              {{/if}}
          </div>
      </div>

      {{!-- Moon Phase Section --}}
      <div class="weather-row">
        <div class="weather-icon">
          <i class="fas fa-moon"></i>
        </div>
        <div class="weather-data">
          <h3>Moon Phase</h3>
          <p>{{weather.moonPhase}}</p>
        </div>
      </div>
    </div>

    {{!-- Weather Controls --}}
    <div class="weather-controls">
      <button type="button" class="generate-weather" {{#if loading}}disabled{{/if}}>
        <i class="fas fa-dice"></i> Generate New Weather
      </button>
      
      {{#if isGM}}
        <button type="button" class="update-weather" {{#if loading}}disabled{{/if}}>
          <i class="fas fa-sync"></i> Update Weather
        </button>
        <button type="button" class="settings" {{#if loading}}disabled{{/if}}>
          <i class="fas fa-cog"></i> Settings
        </button>
      {{/if}}

      <button type="button" class="refresh-weather" {{#if loading}}disabled{{/if}}>
        <i class="fas fa-redo"></i> Refresh
      </button>
    </div>
  </div>
</form>

{{!-- Add debug info section at bottom of template --}}
{{#if error}}
<div class="error-message" style="color: red; margin-top: 10px;">
    Error: {{error}}
</div>
{{/if}}

{{#if debugMode}}
<div class="debug-info" style="margin-top: 10px; font-size: 0.8em; color: #666;">
    Available Months: {{#each months}}{{this}}, {{/each}}<br>
    Selected Month: {{selectedMonth}}<br>
    Latitude: {{latitude}}<br>
    Terrain: {{terrain}}<br>
    Elevation: {{elevation}}
</div>
{{/if}}